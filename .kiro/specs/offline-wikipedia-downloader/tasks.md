# 实施计划

- [x] 1. 建立项目结构和核心数据模型
  - 创建 Models、Services、ViewModels 和 Views 目录结构
  - 实现 WikipediaFile 和 DownloadStatus 数据模型
  - 创建 DownloadTask 类用于管理下载状态
  - _需求: 1.1, 2.1, 3.1_

- [x] 2. 实现网络服务层
  - [x] 2.1 创建 WikipediaFileService 协议和基础实现
    - 定义网络服务接口
    - 实现基础的网络请求功能
    - 添加错误处理机制
    - _需求: 1.1, 1.3_

  - [x] 2.2 实现 Kiwix 镜像站点数据解析
    - 创建 HTML 解析器获取 .zim 文件列表
    - 解析文件名、大小、日期等信息
    - 实现语言识别逻辑
    - 编写解析功能的单元测试
    - _需求: 1.1, 1.2_

  - [x] 2.3 实现文件下载功能
    - 使用 URLSession 实现文件下载
    - 添加下载进度跟踪
    - 实现下载暂停和恢复功能
    - 处理下载失败和重试逻辑
    - _需求: 2.1, 2.2, 2.4, 2.5_

- [x] 3. 创建本地文件管理系统
  - [x] 3.1 实现 ZimFileManager
    - 创建本地文件存储结构
    - 实现文件元数据管理
    - 添加存储空间检查功能
    - _需求: 3.1, 3.4_

  - [x] 3.2 实现文件操作功能
    - 添加文件删除功能
    - 实现文件完整性验证
    - 创建存储信息查询接口
    - 编写文件管理的单元测试
    - _需求: 3.2, 3.3_

- [x] 4. 开发核心视图模型
  - [x] 4.1 创建 DownloadListViewModel
    - 实现文件列表状态管理
    - 添加搜索和筛选逻辑
    - 集成网络服务和文件管理器
    - _需求: 4.1, 4.2, 4.3_

  - [x] 4.2 实现下载管理逻辑
    - 添加下载任务管理
    - 实现下载状态更新
    - 处理并发下载限制
    - 编写视图模型的单元测试
    - _需求: 2.1, 2.2, 2.3_

- [x] 5. 构建用户界面组件
  - [x] 5.1 创建主要列表视图
    - 实现 DownloadListView 主界面
    - 添加分段控制器（可用/已下载）
    - 创建加载状态指示器
    - _需求: 1.1, 1.4, 3.1_

  - [x] 5.2 实现文件行视图组件
    - 创建 FileRowView 显示文件信息
    - 添加下载进度条
    - 实现操作按钮（下载/删除/暂停）
    - _需求: 1.2, 2.2, 3.2_

  - [x] 5.3 开发搜索和筛选界面
    - 实现搜索栏组件
    - 添加语言筛选器
    - 创建排序选项界面
    - _需求: 4.1, 4.2, 4.3, 4.4_

- [x] 6. 实现离线内容查看功能
  - [x] 6.1 创建 ZIM 文件读取器
    - 研究和集成 ZIM 文件读取库
    - 实现基础的文件内容提取
    - 添加文章搜索功能
    - _需求: 5.1, 5.2_

  - [x] 6.2 开发离线维基百科查看器
    - 创建文章显示视图
    - 实现内部链接导航
    - 添加搜索结果显示
    - 处理损坏文件的错误情况
    - _需求: 5.1, 5.3, 5.4_

- [x] 7. 添加错误处理和用户反馈
  - [x] 7.1 实现全局错误处理
    - 创建统一的错误处理机制
    - 添加用户友好的错误消息
    - 实现错误恢复建议
    - _需求: 1.3, 2.4, 3.4, 5.4_

  - [x] 7.2 添加用户通知和反馈
    - 实现下载完成通知
    - 添加存储空间警告
    - 创建操作确认对话框
    - _需求: 2.3, 3.4_

- [ ] 8. 集成测试和优化
  - [ ] 8.1 编写集成测试
    - 测试完整的下载流程
    - 验证文件管理操作
    - 测试网络错误处理
    - _需求: 所有需求_

  - [ ] 8.2 性能优化和最终调试
    - 优化大文件下载性能
    - 减少内存使用
    - 测试并发下载场景
    - 修复发现的问题
    - _需求: 2.1, 2.2_

- [ ] 9. 更新主应用集成
  - 修改 ContentView 集成新的下载功能
  - 更新应用导航结构
  - 确保与现有代码的兼容性
  - _需求: 所有需求_